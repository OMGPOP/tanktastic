<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Tanktastic!</title>

	<script type="text/javascript" src="lib/easeljs-0.4.2.min.js"></script>
	<script type="text/javascript" src="lib/seedrandom.js"></script>
	<script type="text/javascript" src="lib/tanktastic.js"></script>

    <script type="text/javascript">
        var stage;
        var required = [];
        var tanks = [];
        exports = null;
        var game;
				var lx;
        function init()
        {
          tanks = [
            "lib/example-tanks/moron.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js",
            "lib/example-tanks/coward.js" 
              ];
          resolve();
        }

        function startGame()
        {
          stage = new Stage("myCanvas");
          var shape = stage.addChild(new Shape());
          game = new tanktastic.Game(window.location.search, shape.graphics);
          for(var i in required) game.register_tank(required[i]);
					Ticker.addListener(window);
        }

        function appendTank(file)
        {
          exports = {};
          required.push(exports);
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = file + "?r=" + Math.random();
          document.getElementsByTagName("HEAD")[0].appendChild(script);
          setTimeout(resolve, 10);
        }

        function resolve()
        {
          if(exports && !exports.name)
          {
            setTimeout(resolve, 5);
            return;
          }
          if(tanks.length) appendTank(tanks.pop());
          else startGame();
        }

        function tick()
        {
          game.step();
          stage.update();
        }

        function t1_step(dt, state)
        {
          //state.exert(480 - state.x + Math.random() * 1250 - 625, 240 - state.y + Math.random() * 1250 - 625);
					var op = state.radar[0];
					var t = {x:op.x, y:op.y};
					lx.push(op);
					if(lx.length > 3)
					{
						var time = Math.sqrt(Math.pow(state.x - op.x, 2) + Math.pow(state.y - op.y, 2)) / 400;
						t.x += ((lx[1].x - lx[0].x) / dt) * 0.1 * time;
						t.y += ((lx[1].y - lx[0].y) / dt) * 0.1 * time;
						t.x += ((lx[2].x - lx[1].x) / dt) * 0.3 * time;
						t.y += ((lx[2].y - lx[1].y) / dt) * 0.3 * time;
						t.x += ((lx[3].x - lx[2].x) / dt) * 0.6 * time;
						t.y += ((lx[3].y - lx[2].y) / dt) * 0.6 * time;
						lx.shift();
					}
					var dx = t.x - state.x;
					var dy = t.y - state.y;
					state.exert(dx, dy);
          var theta = Math.atan2(t.y - state.y, t.x - state.x);
          state.turn(theta - state.bearing);
          state.fire(0.2);
        }
        
        function t2_step(dt, state)
        {
          //state.exert(100, 0);//480-state.x, 240-state.y);
          state.exert(480 - state.x + Math.random() * 1250 - 625, 240 - state.y + Math.random() * 1250 - 625);
          var op = state.radar[0];
					var dx = op.x - state.x;
					var dy = op.y - state.y;
					state.exert(-dx, -dy);
          var theta = Math.atan2(op.y - state.y, op.x - state.x);
          state.turn(theta - state.bearing);
          state.fire(3.0);
        }


    </script>
</head>
<body onload="init();">
	<canvas id="myCanvas" width="960" height="480"></canvas>
</body>
</html>
